---
title: "Different Correlation Types"
output: 
  github_document:
    toc: true
    fig_width: 10.08
    fig_height: 6
  rmarkdown::html_vignette:
    toc: true
    fig_width: 10.08
    fig_height: 6
tags: [r, correlation, types]
vignette: >
  %\VignetteIndexEntry{Different Correlation Types}
  \usepackage[utf8]{inputenc}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
bibliography: bibliography.bib
---

```{r message=FALSE, warning=FALSE, include=FALSE}
library(knitr)
options(knitr.kable.NA = '')
knitr::opts_chunk$set(comment=">",
  dpi=450)
options(digits=2)

set.seed(333)
```



```{r message=FALSE, warning=FALSE}
library(bayestestR)
library(correlation)
library(ggplot2)
library(tidyr)
library(see)
```

## Distance Correlation

Non-linear relationship

## Comparison


### Utility functions

```{r message=FALSE, warning=FALSE}
generate_results <- function(r, n = 100, noise = 0){
  data <- bayestestR::simulate_correlation(round(n), r = r)
  if(noise > 0){
    data$V2 <- data$V2 + rnorm(nrow(data), 0, noise)
  }
  out <- data.frame(n = n, noise = noise, r = r)
  
  out$Pearson <- cor_test(data, "V1", "V2", method = "pearson")$r
  out$Biweight <- cor_test(data, "V1", "V2", method = "biweight")$r
  out$Distance <- cor_test(data, "V1", "V2", method = "distance")$r
  out
}
```

### Perfect linear link

```{r message=FALSE, warning=FALSE}
data <- data.frame()
for(r in seq(0, 0.99, length.out = 30)){
  for(n in seq(10, 300, length.out = 30)){
    data <- rbind(data, generate_results(r, n))
  }
}

data %>% 
  tidyr::pivot_longer(-c(n, r, noise), names_to = "Type", values_to = "Estimation") %>% 
  ggplot(aes(x = r, y = Estimation, color = Type)) +
  geom_point(aes(size = n), alpha = 0.15) + 
  geom_vline(aes(xintercept = 0.5), linetype = "dashed") +
  geom_hline(aes(yintercept = 0.5), linetype = "dashed") +
  guides(colour = guide_legend(override.aes = list(alpha = 1))) +
  see::theme_modern()
```

### With noise

```{r message=FALSE, warning=FALSE}
data <- data.frame()
for(r in seq(0, 0.99, length.out = 15)){
  for(n in seq(10, 300, length.out = 15)){
    for(noise in c(0.1, 0.5, 1, 1.5)){
      data <- rbind(data, generate_results(r, n, noise = noise))
    }
  }
}

data %>% 
  tidyr::pivot_longer(-c(n, r, noise), names_to = "Type", values_to = "Estimation") %>% 
  ggplot(aes(x = r, y = Estimation, color = Type)) +
  geom_point(aes(size = n), alpha = 0.15) + 
  geom_vline(aes(xintercept = 0.5), linetype = "dashed") +
  geom_hline(aes(yintercept = 0.5), linetype = "dashed") +
  see::theme_modern() +
  guides(colour = guide_legend(override.aes = list(alpha = 1))) +
  facet_wrap(~noise, nrow = 2)
```

# References
